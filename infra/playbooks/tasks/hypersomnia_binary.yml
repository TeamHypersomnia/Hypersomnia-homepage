---
- name: Create Hypersomnia config directories
  file:
    path: "{{ item }}"
    state: directory
    owner: "{{ ansible_user }}"
    group: "{{ ansible_user }}"
    mode: '0755'
  loop:
    - "{{ ansible_user_dir }}/.config/Hypersomnia"
    - "{{ ansible_user_dir }}/.config/Hypersomnia/user"
    - "{{ ansible_user_dir }}/.config/Hypersomnia/user/conf.d"
  become: yes

# Download Hypersomnia binary (shared by masterserver and gameserver)
- name: Create hypersomnia binary directory
  file:
    path: "{{ paths.hypersomnia_bin }}"
    state: directory
    owner: "{{ ansible_user }}"
    group: "{{ ansible_user }}"
    mode: '0755'
  become: yes

- name: Check if Hypersomnia-Headless.AppImage exists
  stat:
    path: "{{ paths.hypersomnia_bin }}/Hypersomnia-Headless.AppImage"
  register: appimage_stat

- name: Download Hypersomnia-Headless.AppImage
  get_url:
    url: "{{ hypersomnia_headless_url }}"
    dest: "{{ paths.hypersomnia_bin }}/Hypersomnia-Headless.AppImage"
    mode: '0755'
    owner: "{{ ansible_user }}"
    group: "{{ ansible_user }}"
  become: yes
  when: not appimage_stat.stat.exists
